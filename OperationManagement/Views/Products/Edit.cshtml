@using OperationManagement.Data.Enums
@model OperationManagement.Data.ViewModels.CreateProductVM
@{
    ViewData["Title"] = "Edit";
}

<h1>Edit</h1>

<h4>Product</h4>
<hr />
<form asp-action="Edit">
    <input type="hidden" asp-for="Product.Id"/>
    <input type="hidden" asp-for="CategoryId" />
    <div class="row">
        <div class="col-md-12">
            <div>
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <div class="form-group">
                    <label asp-for="@Model.Product.OrderId" class="control-label">Order Enterprise Id</label>
                    <input asp-for="@Model.Product.OrderId" class="form-control" readonly/>
                </div>
                <div class="form-group">
                    <label asp-for="@Model.Product.EnterpriseCode" class="control-label">Enterprise Product Code</label>
                    <input asp-for="@Model.Product.EnterpriseCode" class="form-control" />
                    <span asp-validation-for="@Model.Product.EnterpriseCode" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="@Model.Product.Name" class="control-label"></label>
                    <input asp-for="@Model.Product.Name" class="form-control" />
                    <span asp-validation-for="@Model.Product.Name" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="@Model.Product.Description" class="control-label"></label>
                    <textarea asp-for="@Model.Product.Description" class="form-control" ></textarea>
                    <span asp-validation-for="@Model.Product.Description" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="@Model.Product.Price" class="control-label"></label>
                    <input asp-for="@Model.Product.Price" class="form-control" />
                    <span asp-validation-for="@Model.Product.Price" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="@Model.Product.Quantity" class="control-label"></label>
                    <input asp-for="@Model.Product.Quantity" class="form-control" />
                    <span asp-validation-for="@Model.Product.Quantity" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="@Model.CategoryId" class="control-label">Category</label>
                    <select asp-for="@Model.Product.CategoryId" class="form-control" asp-items="ViewBag.CategoryId"></select>
                </div>
            </div>
            <h4>Specifications</h4>
            <hr />
            <div id="specifications-container col-md-12">
                <table class="table">
                    <thead>
                        <tr>
                            <th>
                                Specification
                            </th>
                            <th>
                                Action
                            </th>
                            <th>
                                Option
                            </th>
                            <th>
                                Status
                            </th>
                            <th>
                                Date
                            </th>
                            <th>
                                Remark
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            int i = 0;
                        }
                        @foreach (var spec in Model.Specifications)
                        {
                            <tr>
                                <td>
                                    <input type="hidden" asp-for="@Model.ProductSpecifications[@i].Item2.SpecificationId" value="@spec.Id" />
                                    <label class="control-label">@spec.Name :</label>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <input type="radio" asp-for="@Model.ProductSpecifications[@i].Item1" value="true" />
                                        <label>Add</label>
                                        <input type="radio" asp-for="@Model.ProductSpecifications[@i].Item1" value="false" checked />
                                        <label>remove</label>
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <select asp-for="@Model.ProductSpecifications[@i].Item2.OptionId">
                                            @foreach (var op in spec.Options)
                                            {
                                                <option value="@op.Id">@op.Name</option>
                                            }
                                        </select>
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <select asp-for="@Model.ProductSpecifications[@i].Item2.StatusId">
                                            @foreach (var st in spec.Statuses)
                                            {
                                                <option value="@st.Id">@st.Name</option>
                                            }
                                        </select>
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <input asp-for="@Model.ProductSpecifications[@i].Item2.Date" />
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <textarea asp-for="@Model.ProductSpecifications[@i].Item2.Remark"></textarea>
                                    </div>
                                </td>
                            </tr>
                            i++;
                        }
                    </tbody>
                </table>
            </div>
            <h4 class="mt-3">Measurements</h4>
            <hr />
            <div id="measurments-container col-md-12">
                @{
                    i = 0;
                }
                @foreach (var meag in Model.Measurements)
                {
                    <div class="form-group mt-2">
                        <input type="hidden" asp-for="@Model.ProductMeasurements[@i].MeasurementId" value="@meag.Id" />
                        <label class="control-label">@meag.Name :</label>
                        <input type="number" asp-for="@Model.ProductMeasurements[@i].Value" />
                        <select asp-for="@Model.ProductMeasurements[@i].Unit">
                            @foreach (var unit in Enum.GetValues(typeof(MeasurementUnit)))
                            {
                                <option value="@unit">@unit</option>
                            }
                        </select>
                    </div>
                    i++;
                }
            </div>
            <h4 class="mt-3">Processes</h4>
            <hr />
            <div id="processes-container col-md-12">
                <table class="table">
                    <thead>
                        <tr>
                            <th>
                                Process
                            </th>
                            <th>
                                Action
                            </th>
                            <th>
                                Status
                            </th>
                            <th>
                                StartDate
                            </th>
                            <th>
                                EndDate
                            </th>
                            <th>
                                EstimatedDuration
                            </th>
                            <th>
                                Comment
                            </th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            i = 0;
                        }
                        @foreach (var process in Model.Processes)
                        {
                            <tr>
                                <td>
                                    <div class="form-group">
                                        <input type="hidden" asp-for="@Model.ProductProcesses[@i].Item2.ProcessId" value="@process.Id" />
                                        <label class="control-label">@process.Name :</label>
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <input type="radio" asp-for="@Model.ProductProcesses[@i].Item1" value="true" />
                                        <label>Add</label>
                                        <input type="radio" asp-for="@Model.ProductProcesses[@i].Item1" value="false" checked />
                                        <label>remove</label>
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <select asp-for="@Model.ProductProcesses[@i].Item2.StatusId">
                                            @foreach (var st in process.Statuses)
                                            {
                                                <option value="@st.Id">@st.Name</option>
                                            }
                                        </select>
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <input asp-for="@Model.ProductProcesses[@i].Item2.StartDate" />
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <input asp-for="@Model.ProductProcesses[@i].Item2.EndDate" />
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <input asp-for="@Model.ProductProcesses[@i].Item2.EstimatedDuration" />
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <textarea class="mt-3" asp-for="@Model.ProductProcesses[@i].Item2.Comment"></textarea>
                                    </div>
                                </td>
                            </tr>
                            i++;
                        }
                    </tbody>
                </table>
            </div>
            <h4 class="mt-3">Components</h4>
            <hr />
            <div id="component-container col-md-12">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Photo</th>
                            <th>Name</th>
                            <th>Actions</th>
                            <th>Quantity</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            i = 0;
                        }
                        @foreach (var component in Model.Components)
                        {
                             var url = Consts.ComponentImgUrl;
                            if(component.Photos!=null&&component.Photos.Count()!=0){
                                url = component.Photos.First().PhotoURL;
                            }
                            <tr>
                                <td>
                                    <div class="form-group">
                                        <img src=".@url" style="width:50px; height:50px;" />
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <input type="hidden" asp-for="@Model.ProductComponents[@i].Item2.ComponentId" value="@component.Id" />
                                        <label class="control-label">@component.Name :</label>
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <input type="radio" asp-for="@Model.ProductComponents[@i].Item1" value="true" />
                                        <label>Add</label>
                                        <input type="radio" asp-for="@Model.ProductComponents[@i].Item1" value="false" checked />
                                        <label>remove</label>
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group">
                                        <label class="control-label mt-3">Quantity</label>
                                        <input asp-for="@Model.ProductComponents[@i].Item2.Quantity" value="0" />
                                    </div>
                                </td>
                            </tr>
                            i++;
                        }
                    </tbody>

                </table>
            </div>
        </div>
        <div class="form-group mt-3">
            <input type="submit" value="Save" class="btn btn-primary" />
        </div>
    </div>
</form>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
